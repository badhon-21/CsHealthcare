
@{
    ViewBag.Title = "Better Life | Insert Patient Information";
}

<div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
    <h4 class="modal-title">Patient Information</h4>
</div>

<div class="modal-body">
    <div class="form-horizontal">
        
        <div class="form-group">
            <div class="control-label col-md-3">Patient Name:</div>
            <div class="col-md-8">
                <input id="txtPatientName" required="required" class="form-control" type="text"/>
            </div>
        </div>

        <div class="form-group">
            <div class="control-label col-md-3">Father Name:</div>
            <div class="col-md-8">
                <input id="txtFatherName" required="required" class="form-control" type="text"/>
            </div>
        </div>

        <div class="form-group">
            <div class="control-label col-md-3">Mother Name:</div>
            <div class="col-md-8">
                <input id="txtMotherName" required="required" class="form-control" type="text"/>
            </div>
        </div>

        <div class="form-group">
            <div class="control-label col-md-3">Referance Name:</div>
            <div class="col-md-8">
                <input id="txtReferanceName" required="required" class="form-control" type="text"/>
            </div>
        </div>

        <div class="form-group">
            <div class="control-label col-md-3">Date Of Birth:</div>
            <div class="col-md-8">
                <input id="txtDateOfBirth" required="required" class="form-control dateofbirth" type="text" />
            </div>

        </div>

        <div class="form-group">
            <div class="control-label col-md-3">Age:</div>
            <div class="col-md-8">
                <select id="ddlAge" class="form-control">
                    <option value=""></option>
                    <option value="0">0</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10">10</option>
                    <option value="11">11</option>
                    <option value="12">12</option>
                    <option value="13">13</option>
                    <option value="14">14</option>
                    <option value="15">15</option>
                    <option value="16">16</option>
                    <option value="17">17</option>
                    <option value="18">18</option>
                    <option value="19">19</option>
                    <option value="20">20</option>
                    <option value="21">21</option>
                    <option value="22">22</option>
                    <option value="23">23</option>
                    <option value="24">24</option>
                    <option value="25">25</option>
                    <option value="26">26</option>
                    <option value="27">27</option>
                    <option value="28">28</option>
                    <option value="29">29</option>
                    <option value="30">30</option>
                    <option value="31">31</option>
                    <option value="32">32</option>
                    <option value="33">33</option>
                    <option value="34">34</option>
                    <option value="35">35</option>
                    <option value="36">36</option>
                    <option value="37">37</option>
                    <option value="38">38</option>
                    <option value="39">39</option>
                    <option value="40">40</option>
                    <option value="41">41</option>
                    <option value="42">42</option>
                    <option value="43">43</option>
                    <option value="44">44</option>
                    <option value="45">45</option>
                    <option value="46">46</option>
                    <option value="47">47</option>
                    <option value="48">48</option>
                    <option value="49">49</option>
                    <option value="50">50</option>
                    <option value="51">51</option>
                    <option value="52">52</option>
                    <option value="53">53</option>
                    <option value="54">54</option>
                    <option value="55">55</option>
                    <option value="56">56</option>
                    <option value="57">57</option>
                    <option value="58">58</option>
                    <option value="59">59</option>
                    <option value="60">60</option>
                    <option value="61">61</option>
                    <option value="62">62</option>
                    <option value="63">63</option>
                    <option value="64">64</option>
                    <option value="65">65</option>
                    <option value="66">66</option>
                    <option value="67">67</option>
                    <option value="68">68</option>
                    <option value="69">69</option>
                    <option value="70">70</option>
                    <option value="71">71</option>
                    <option value="72">72</option>
                    <option value="73">73</option>
                    <option value="74">74</option>
                    <option value="75">75</option>
                    <option value="76">76</option>
                    <option value="77">77</option>
                    <option value="78">78</option>
                    <option value="79">79</option>
                    <option value="80">80</option>
                    <option value="81">81</option>
                    <option value="82">82</option>
                    <option value="83">83</option>
                    <option value="84">84</option>
                    <option value="85">85</option>
                    <option value="86">86</option>
                    <option value="87">87</option>
                    <option value="88">88</option>
                    <option value="89">89</option>
                    <option value="90">90</option>
                    <option value="91">91</option>
                    <option value="92">92</option>
                    <option value="93">93</option>
                    <option value="94">94</option>
                    <option value="95">95</option>
                    <option value="96">96</option>
                    <option value="97">97</option>
                    <option value="98">98</option>
                    <option value="99">99</option>
                    <option value="100">100</option>
                    <option value="101">101</option>
                    <option value="102">102</option>
                    <option value="103">103</option>
                    <option value="104">104</option>
                    <option value="105">105</option>
                    <option value="106">106</option>
                    <option value="107">107</option>
                    <option value="108">108</option>
                    <option value="109">109</option>
                    <option value="110">110</option>
                    <option value="111">111</option>
                    <option value="112">112</option>
                    <option value="113">113</option>
                    <option value="114">114</option>
                    <option value="115">115</option>
                    <option value="116">116</option>
                    <option value="117">117</option>
                    <option value="118">118</option>
                    <option value="119">119</option>
                    <option value="120">120</option>
                </select>
            </div>
        </div>

        <div class="form-group">
            <div class="control-label col-md-3">Blood Group:</div>
            <div class="col-md-8">
                <select id="ddlBloodGroup" class="form-control">
                    <option value=""></option>
                    <option value="A+">A+</option>
                    <option value="A-">A-</option>
                    <option value="B+">B+</option>
                    <option value="B-">B-</option>
                    <option value="O+">O+</option>
                    <option value="O-">O-</option>
                    <option value="AB+">AB+</option>
                    <option value="AB-">AB-</option>
                </select>
            </div>
        </div>

        <div class="form-group">
            <div class="control-label col-md-3">Address:</div>
            <div class="col-md-8">
                <input id="txtAddress" required="required" class="form-control" type="text" />
            </div>
        </div>

        <div class="form-group">
            <div class="control-label col-md-3">Sex:</div>
            <div class="col-md-8">
                <select id="ddlSex" class="form-control">
                    <option value=""></option>
                    <option value="MALE">MALE</option>
                    <option value="FEMALE">FEMALE</option>
                </select>
            </div>
        </div>

        <div class="form-group">
            <div class="control-label col-md-3">Mobile No:</div>
            <div class="col-md-8">
                <input id="txtMobileNo" required="required" class="form-control" type="text" />
            </div>
        </div>


    </div>
</div>

<div class="modal-footer">
    <button type="button" data-dismiss="modal" class="btn default">Cancel</button>
    <button type="button" data-dismiss="modal" class="btn green" onclick="javascript: updatePatientInformation();">Update</button>
</div>


@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")

    

}

<script type="text/javascript">
    jQuery(document).ready(function () {
        ComponentsPickers.init();
        loadPatientInformation();
        dateChangeEvent();
    });

        function calculateAge(birthMonth, birthDay, birthYear) {
            var currentDate = new Date();
            var currentYear = currentDate.getFullYear();
            var currentMonth = currentDate.getMonth();
            var currentDay = currentDate.getDate();
            age = currentYear - birthYear;

            if (currentMonth < birthMonth - 1) {
                age--;
            }
            if (birthMonth - 1 == currentMonth && currentDay < birthDay) {
                age--;
            }
            return age;
        }

        function loadPatientInformation() {
            $.ajax({
                type: "GET",
                cache: false,
                url: "@(@Url.Action("getPatientInformation", "History", new { Area = "PatientManagement" }))",
                data: { "Id": $('#txtPatientId').val() },
                dataType: "html",
                success: function (result) {
                    var value = JSON.parse(result);
                    $.each(value, function () {
                        var dob = new Date(parseInt(value.DateOfBirth.substr(6)));
                        var day = (dob.getDate() < 10 ? '0' : '') + dob.getDate();
                        var month = ((dob.getMonth() + 1) < 10 ? '0' : '') + (dob.getMonth() + 1);
                        
                        $('#txtPatientId').val(value.Id);
                        $('#txtPatientName').val(value.Name);
                        $('#txtFatherName').val(value.FatherName);
                        $('#txtMotherName').val(value.MotherName);
                        $('#txtReferanceName').val(value.ReferanceName);
                        $('#txtDateOfBirth').val(month + "/" + day + "/" + dob.getFullYear());
                        $('#ddlAge').val(calculateAge(dob.getMonth(), dob.getDate(), dob.getFullYear()));
                        $('#ddlSex').val(value.Sex);
                        $('#ddlBloodGroup').val(value.BloodGroup);
                        $('#txtAddress').val(value.Address);
                        $('#txtMobileNo').val(value.MobileNo);                       
                    });
                },
                error: function (error) {
                    //Metronic.unblockUI(el);
                    var msg = 'Fail to load patient information.';
                    alert(msg);
                }
            });
        }

    function updatePatientInformation() {
        $.ajax({
            type: "POST",
            url: "@(@Url.Action("UpdatePatient", "History", new { Area = "PatientManagement" }))",
            data: {
                "PatientId": $('#txtPatientId').val(),
                "PatientName": $('#txtPatientName').val(),
                "FatherName": $('#txtFatherName').val(),
                "MotherName": $('#txtMotherName').val(),
                "ReferanceName": $('#txtReferanceName').val(),
                "DateOfBirth": $('#txtDateOfBirth').val(),
                "Sex": $('#ddlSex').val(),
                "BloodGroup": $('#ddlBloodGroup').val(),
                "Address": $('#txtAddress').val(),
                "MobileNo": $('#txtMobileNo').val()
            },
        success: function (data) {
        },
        error: function (error) {
            //Metronic.unblockUI(el);
            var msg = 'Fail to update patient information';
            alert(msg);
        }
    });
    }

    function dateChangeEvent() {
        $('.dateofbirth').datepicker().on('changeDate', function (ev) {
            var dob = new Date($('#txtDateOfBirth').val());
            var day = (dob.getDate() < 10 ? '0' : '') + dob.getDate();
            var month = ((dob.getMonth() + 1) < 10 ? '0' : '') + (dob.getMonth() + 1);
            $('#ddlAge').val(calculateAge(month, day, dob.getFullYear()));
        });
    }
</script>